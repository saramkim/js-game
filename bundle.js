/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
var __webpack_exports__ = {};
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/


var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
canvas.width = 600;
canvas.height = 800;
canvas.style.border = '1px solid black';
canvas.style.position = 'fixed';
canvas.style.left = "calc(50% - ".concat(canvas.width / 2, "px)");
canvas.style.top = "calc(50% - ".concat(canvas.height / 2, "px)");

while (window.innerWidth < canvas.width) {
  canvas.width -= 20;
  canvas.style.left = "calc(50% - ".concat(canvas.width / 2, "px)");
}

while (window.innerHeight < canvas.height) {
  canvas.height -= 50;
  canvas.style.top = "calc(50% - ".concat(canvas.height / 2, "px)");
} // const img1 = new Image();
// img1.src = "bear.png";


var player = {
  width: 50,
  height: 50,
  x: (canvas.width - 50) / 2,
  y: canvas.height - 50,
  draw: function () {
    ctx.fillStyle = 'green';
    ctx.fillRect(this.x, this.y, this.width, this.height); // ctx.drawImage(img1, this.x, this.y, this.width, this.height);
  }
};

var Block =
/** @class */
function () {
  function Block(location) {
    this.width = 50;
    this.height = 50;
    this.x = Math.random() * (canvas.width / DIFFICULTY - this.width) + location * (canvas.width / DIFFICULTY);
    this.y = 0;
  }

  Block.prototype.draw = function () {
    ctx.fillStyle = 'red';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  };

  return Block;
}();

var Bonus =
/** @class */
function () {
  function Bonus() {
    this.width = 50;
    this.height = 50;
    this.x = Math.random() * (canvas.width - this.width);
    this.y = 0;
  }

  Bonus.prototype.draw = function () {
    ctx.fillStyle = 'blue';
    ctx.fillRect(this.x, this.y, this.width, this.height);
  };

  return Bonus;
}();

var timer = 0;
var score = 0;
var goLeft = false;
var goRight = false;
var leftTimer = 0;
var rightTimer = 0;
var canUseItem = true;
var curStatus = 'intro';
var animation;
var longTabTimer;
var BLOCK_TIME = 60;
var MOVE_SPEED = 10;
var TIMER_TIME = 3;
var DIFFICULTY = 3;
var blockArray = [];
var bonusArray = [];

if (curStatus === 'intro') {
  ctx.fillStyle = 'green';
  ctx.font = 'bold 48px san-serif';
  ctx.fillText('Block a Block', 50, 400);
  ctx.font = 'bold 30px san-serif';
  ctx.fillText("Difficulty: ".concat(String(DIFFICULTY)), 50, 300);
  ctx.fillText("Press 'Enter' to start!", 50, 500);
}

function Frame() {
  animation = requestAnimationFrame(Frame);
  timer++;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillText(String(score), 50, 100);

  for (var i = 0; i < DIFFICULTY; i++) {
    if ((timer + BLOCK_TIME / DIFFICULTY * i) % BLOCK_TIME === 0) {
      var block = new Block(i);
      blockArray.push(block);
    }
  }

  blockArray.forEach(function (block, index, array) {
    var CollisionCheck = function (fn) {
      return array.filter(function (v) {
        return v !== block;
      }).findIndex(function (stopedBlock) {
        return fn(stopedBlock, block);
      });
    };

    var collisionEachOther = CollisionCheck(Collision);
    var LeftCollisionEachOther = CollisionCheck(LeftCollision);
    var RightCollisionEachOther = CollisionCheck(RightCollision);
    var stacking = collisionEachOther !== -1 || Collision(player, block);
    var pushingLeft = LeftCollisionEachOther !== -1 || LeftCollision(player, block);
    var pushingRight = RightCollisionEachOther !== -1 || RightCollision(player, block);

    if (block.y < canvas.height) {
      !stacking && (block.y += 1);
    } else {
      array.splice(index, 1);
      score++;
    }

    if (stacking) {
      GoLeft(block);
      GoRight(block);
    } else if (pushingLeft) {
      GoLeft(block);
    } else if (pushingRight) {
      GoRight(block);
    }

    if (block.y === 0) {
      window.cancelAnimationFrame(animation);
      curStatus = 'end';
      ctx.clearRect(0, 200, canvas.width, 350);
      ctx.fillStyle = 'green';
      ctx.font = 'bold 48px san-serif';
      ctx.fillText(String(score), 50, 300);
      ctx.fillText('Game Over', 50, 400);
      ctx.font = 'bold 30px san-serif';
      ctx.fillText("Press 'Enter' to start!", 50, 500);
    }

    block.draw();
  }); // bonus ------------

  if (timer % 1000 === 0) {
    var bonus = new Bonus();
    bonusArray.push(bonus);
  }

  bonusArray.forEach(function (bonus, index, array) {
    var collide = Collision(player, bonus) || LeftCollision(player, bonus) || RightCollision(player, bonus);
    collide && (score += 10);
    bonus.y < 900 && !collide ? bonus.y += 5 : array.splice(index, 1);
    bonus.draw();
  }); // control ------------

  GoLeft(player);
  GoRight(player);
  goLeft && leftTimer++;
  goRight && rightTimer++;

  if (leftTimer > TIMER_TIME) {
    goLeft = false;
    leftTimer = 0;
  }

  if (rightTimer > TIMER_TIME) {
    goRight = false;
    rightTimer = 0;
  }

  player.draw();
}

function Collision(pre, cur) {
  var xCollision = Math.abs(pre.x - cur.x) < pre.width;
  var yCollision = pre.y - cur.y === pre.height;
  return xCollision && yCollision;
}

function LeftCollision(pre, cur) {
  var xCollision = pre.x - cur.x <= pre.width && pre.x - cur.x > 0;
  var yCollision = Math.abs(pre.y - cur.y) < pre.height;
  return xCollision && yCollision;
}

function RightCollision(pre, cur) {
  var xCollision = cur.x - pre.x <= pre.width && cur.x - pre.x > 0;
  var yCollision = Math.abs(pre.y - cur.y) < pre.height;
  return xCollision && yCollision;
}

function GoLeft(thing) {
  player.x > 0 && goLeft && (thing.x -= MOVE_SPEED);
}

function GoRight(thing) {
  player.x + player.width < canvas.width && goRight && (thing.x += MOVE_SPEED);
}

function handleLeftEvent() {
  if (curStatus === 'intro' && DIFFICULTY > 1) {
    DIFFICULTY--;
    ctx.clearRect(0, 100, 500, 250);
    ctx.fillText("Difficulty: ".concat(String(DIFFICULTY)), 50, 300);
  }
}

function handleRightEvent() {
  if (curStatus === 'intro' && DIFFICULTY < 6) {
    DIFFICULTY++;
    ctx.clearRect(0, 100, 500, 250);
    ctx.fillText("Difficulty: ".concat(String(DIFFICULTY)), 50, 300);
  }
}

document.addEventListener('keydown', function (key) {
  switch (key.code) {
    case 'Enter':
      if (curStatus === 'intro') {
        animation = requestAnimationFrame(Frame);
        curStatus = 'start';
      } else if (curStatus === 'end') {
        blockArray.splice(0);
        bonusArray.splice(0);
        timer = 0;
        score = 0;
        canUseItem = true;
        animation = requestAnimationFrame(Frame);
        curStatus = 'start';
      }

      break;

    case 'ArrowLeft':
    case 'KeyA':
      handleLeftEvent();
      goLeft = true;
      break;

    case 'ArrowRight':
    case 'KeyD':
      handleRightEvent();
      goRight = true;
      break;

    case 'Space':
      if (canUseItem === true) {
        blockArray.splice(0);
        canUseItem = false;
      }

      break;

    case 'Escape':
      if (curStatus === 'end') {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillText("Press 'Enter' to start!", 50, 400);
        curStatus = 'intro';
      }

  }
});
canvas.addEventListener('touchstart', function (event) {
  var xTouch = event.changedTouches[0].clientX;
  var yTouch = event.changedTouches[0].clientY;

  if (curStatus === 'intro') {
    longTabTimer = setTimeout(function () {
      animation = requestAnimationFrame(Frame);
      curStatus = 'start';
    }, 1000);
  } else if (curStatus === 'end') {
    longTabTimer = setTimeout(function () {
      blockArray.splice(0);
      bonusArray.splice(0);
      timer = 0;
      score = 0;
      canUseItem = true;
      animation = requestAnimationFrame(Frame);
      curStatus = 'start';
    }, 1000);
  }

  if (yTouch < 300 && canUseItem) {
    blockArray.splice(0);
    canUseItem = false;
  }

  if (xTouch < canvas.width / 2) {
    goLeft = true;
  } else if (xTouch > canvas.width / 2) {
    goRight = true;
  }
});
canvas.addEventListener('touchend', function (event) {
  var xTouch = event.changedTouches[0].clientX;
  var yTouch = event.changedTouches[0].clientY;
  clearTimeout(longTabTimer);

  if (xTouch < canvas.width / 2) {
    handleLeftEvent();
  } else if (xTouch > canvas.width / 2) {
    handleRightEvent();
  }
});
canvas.addEventListener('touchmove', function () {
  clearTimeout(longTabTimer);
});
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVAsQ0FBd0IsV0FBeEIsRUFBcUM7RUFDbkNVLFlBQVksQ0FBQ3pELFlBQUQsQ0FBWjtBQUNELENBRkQsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2dhbWUvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xyXG5jb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSE7XHJcblxyXG5jYW52YXMud2lkdGggPSA2MDA7XHJcbmNhbnZhcy5oZWlnaHQgPSA4MDA7XHJcbmNhbnZhcy5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkIGJsYWNrJztcclxuY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcclxuY2FudmFzLnN0eWxlLmxlZnQgPSBgY2FsYyg1MCUgLSAke2NhbnZhcy53aWR0aCAvIDJ9cHgpYDtcclxuY2FudmFzLnN0eWxlLnRvcCA9IGBjYWxjKDUwJSAtICR7Y2FudmFzLmhlaWdodCAvIDJ9cHgpYDtcclxuXHJcbndoaWxlICh3aW5kb3cuaW5uZXJXaWR0aCA8IGNhbnZhcy53aWR0aCkge1xyXG4gIGNhbnZhcy53aWR0aCAtPSAyMDtcclxuICBjYW52YXMuc3R5bGUubGVmdCA9IGBjYWxjKDUwJSAtICR7Y2FudmFzLndpZHRoIC8gMn1weClgO1xyXG59XHJcbndoaWxlICh3aW5kb3cuaW5uZXJIZWlnaHQgPCBjYW52YXMuaGVpZ2h0KSB7XHJcbiAgY2FudmFzLmhlaWdodCAtPSA1MDtcclxuICBjYW52YXMuc3R5bGUudG9wID0gYGNhbGMoNTAlIC0gJHtjYW52YXMuaGVpZ2h0IC8gMn1weClgO1xyXG59XHJcblxyXG50eXBlIEZuID0gKHN0b3BlZEJsb2NrOiBCbG9jaywgYmxvY2s6IEJsb2NrKSA9PiBib29sZWFuO1xyXG5cclxuLy8gY29uc3QgaW1nMSA9IG5ldyBJbWFnZSgpO1xyXG4vLyBpbWcxLnNyYyA9IFwiYmVhci5wbmdcIjtcclxuXHJcbmNvbnN0IHBsYXllciA9IHtcclxuICB3aWR0aDogNTAsXHJcbiAgaGVpZ2h0OiA1MCxcclxuICB4OiAoY2FudmFzLndpZHRoIC0gNTApIC8gMixcclxuICB5OiBjYW52YXMuaGVpZ2h0IC0gNTAsXHJcbiAgZHJhdygpIHtcclxuICAgIGN0eC5maWxsU3R5bGUgPSAnZ3JlZW4nO1xyXG4gICAgY3R4LmZpbGxSZWN0KHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcbiAgICAvLyBjdHguZHJhd0ltYWdlKGltZzEsIHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcbiAgfSxcclxufTtcclxuXHJcbmNsYXNzIEJsb2NrIHtcclxuICB4OiBudW1iZXI7XHJcbiAgeTogbnVtYmVyO1xyXG4gIHdpZHRoOiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGxvY2F0aW9uOiBudW1iZXIpIHtcclxuICAgIHRoaXMud2lkdGggPSA1MDtcclxuICAgIHRoaXMuaGVpZ2h0ID0gNTA7XHJcbiAgICB0aGlzLnggPVxyXG4gICAgICBNYXRoLnJhbmRvbSgpICogKGNhbnZhcy53aWR0aCAvIERJRkZJQ1VMVFkgLSB0aGlzLndpZHRoKSArXHJcbiAgICAgIGxvY2F0aW9uICogKGNhbnZhcy53aWR0aCAvIERJRkZJQ1VMVFkpO1xyXG4gICAgdGhpcy55ID0gMDtcclxuICB9XHJcbiAgZHJhdygpIHtcclxuICAgIGN0eC5maWxsU3R5bGUgPSAncmVkJztcclxuICAgIGN0eC5maWxsUmVjdCh0aGlzLngsIHRoaXMueSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgQm9udXMge1xyXG4gIHg6IG51bWJlcjtcclxuICB5OiBudW1iZXI7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxuICBoZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLndpZHRoID0gNTA7XHJcbiAgICB0aGlzLmhlaWdodCA9IDUwO1xyXG4gICAgdGhpcy54ID0gTWF0aC5yYW5kb20oKSAqIChjYW52YXMud2lkdGggLSB0aGlzLndpZHRoKTtcclxuICAgIHRoaXMueSA9IDA7XHJcbiAgfVxyXG4gIGRyYXcoKSB7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gJ2JsdWUnO1xyXG4gICAgY3R4LmZpbGxSZWN0KHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcbiAgfVxyXG59XHJcblxyXG5sZXQgdGltZXIgPSAwO1xyXG5sZXQgc2NvcmUgPSAwO1xyXG5sZXQgZ29MZWZ0ID0gZmFsc2U7XHJcbmxldCBnb1JpZ2h0ID0gZmFsc2U7XHJcbmxldCBsZWZ0VGltZXIgPSAwO1xyXG5sZXQgcmlnaHRUaW1lciA9IDA7XHJcbmxldCBjYW5Vc2VJdGVtID0gdHJ1ZTtcclxubGV0IGN1clN0YXR1czogJ2ludHJvJyB8ICdzdGFydCcgfCAnZW5kJyA9ICdpbnRybyc7XHJcbmxldCBhbmltYXRpb246IG51bWJlcjtcclxubGV0IGxvbmdUYWJUaW1lcjogTm9kZUpTLlRpbWVvdXQ7XHJcblxyXG52YXIgQkxPQ0tfVElNRSA9IDYwO1xyXG52YXIgTU9WRV9TUEVFRCA9IDEwO1xyXG52YXIgVElNRVJfVElNRSA9IDM7XHJcbnZhciBESUZGSUNVTFRZOiAxIHwgMiB8IDMgfCA0IHwgNSB8IDYgPSAzO1xyXG5cclxuY29uc3QgYmxvY2tBcnJheTogQmxvY2tbXSA9IFtdO1xyXG5jb25zdCBib251c0FycmF5OiBCb251c1tdID0gW107XHJcblxyXG5pZiAoY3VyU3RhdHVzID09PSAnaW50cm8nKSB7XHJcbiAgY3R4LmZpbGxTdHlsZSA9ICdncmVlbic7XHJcbiAgY3R4LmZvbnQgPSAnYm9sZCA0OHB4IHNhbi1zZXJpZic7XHJcbiAgY3R4LmZpbGxUZXh0KCdCbG9jayBhIEJsb2NrJywgNTAsIDQwMCk7XHJcbiAgY3R4LmZvbnQgPSAnYm9sZCAzMHB4IHNhbi1zZXJpZic7XHJcbiAgY3R4LmZpbGxUZXh0KGBEaWZmaWN1bHR5OiAke1N0cmluZyhESUZGSUNVTFRZKX1gLCA1MCwgMzAwKTtcclxuICBjdHguZmlsbFRleHQoXCJQcmVzcyAnRW50ZXInIHRvIHN0YXJ0IVwiLCA1MCwgNTAwKTtcclxufVxyXG5mdW5jdGlvbiBGcmFtZSgpIHtcclxuICBhbmltYXRpb24gPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoRnJhbWUpO1xyXG4gIHRpbWVyKys7XHJcbiAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gIGN0eC5maWxsVGV4dChTdHJpbmcoc2NvcmUpLCA1MCwgMTAwKTtcclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBESUZGSUNVTFRZOyBpKyspIHtcclxuICAgIGlmICgodGltZXIgKyAoQkxPQ0tfVElNRSAvIERJRkZJQ1VMVFkpICogaSkgJSBCTE9DS19USU1FID09PSAwKSB7XHJcbiAgICAgIGNvbnN0IGJsb2NrID0gbmV3IEJsb2NrKGkpO1xyXG4gICAgICBibG9ja0FycmF5LnB1c2goYmxvY2spO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYmxvY2tBcnJheS5mb3JFYWNoKChibG9jaywgaW5kZXgsIGFycmF5KSA9PiB7XHJcbiAgICBjb25zdCBDb2xsaXNpb25DaGVjayA9IChmbjogRm4pID0+XHJcbiAgICAgIGFycmF5XHJcbiAgICAgICAgLmZpbHRlcigodikgPT4gdiAhPT0gYmxvY2spXHJcbiAgICAgICAgLmZpbmRJbmRleCgoc3RvcGVkQmxvY2spID0+IGZuKHN0b3BlZEJsb2NrLCBibG9jaykpO1xyXG4gICAgY29uc3QgY29sbGlzaW9uRWFjaE90aGVyID0gQ29sbGlzaW9uQ2hlY2soQ29sbGlzaW9uKTtcclxuICAgIGNvbnN0IExlZnRDb2xsaXNpb25FYWNoT3RoZXIgPSBDb2xsaXNpb25DaGVjayhMZWZ0Q29sbGlzaW9uKTtcclxuICAgIGNvbnN0IFJpZ2h0Q29sbGlzaW9uRWFjaE90aGVyID0gQ29sbGlzaW9uQ2hlY2soUmlnaHRDb2xsaXNpb24pO1xyXG4gICAgY29uc3Qgc3RhY2tpbmcgPSBjb2xsaXNpb25FYWNoT3RoZXIgIT09IC0xIHx8IENvbGxpc2lvbihwbGF5ZXIsIGJsb2NrKTtcclxuICAgIGNvbnN0IHB1c2hpbmdMZWZ0ID1cclxuICAgICAgTGVmdENvbGxpc2lvbkVhY2hPdGhlciAhPT0gLTEgfHwgTGVmdENvbGxpc2lvbihwbGF5ZXIsIGJsb2NrKTtcclxuICAgIGNvbnN0IHB1c2hpbmdSaWdodCA9XHJcbiAgICAgIFJpZ2h0Q29sbGlzaW9uRWFjaE90aGVyICE9PSAtMSB8fCBSaWdodENvbGxpc2lvbihwbGF5ZXIsIGJsb2NrKTtcclxuXHJcbiAgICBpZiAoYmxvY2sueSA8IGNhbnZhcy5oZWlnaHQpIHtcclxuICAgICAgIXN0YWNraW5nICYmIChibG9jay55ICs9IDEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYXJyYXkuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgc2NvcmUrKztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc3RhY2tpbmcpIHtcclxuICAgICAgR29MZWZ0KGJsb2NrKTtcclxuICAgICAgR29SaWdodChibG9jayk7XHJcbiAgICB9IGVsc2UgaWYgKHB1c2hpbmdMZWZ0KSB7XHJcbiAgICAgIEdvTGVmdChibG9jayk7XHJcbiAgICB9IGVsc2UgaWYgKHB1c2hpbmdSaWdodCkge1xyXG4gICAgICBHb1JpZ2h0KGJsb2NrKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYmxvY2sueSA9PT0gMCkge1xyXG4gICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUoYW5pbWF0aW9uKTtcclxuICAgICAgY3VyU3RhdHVzID0gJ2VuZCc7XHJcbiAgICAgIGN0eC5jbGVhclJlY3QoMCwgMjAwLCBjYW52YXMud2lkdGgsIDM1MCk7XHJcbiAgICAgIGN0eC5maWxsU3R5bGUgPSAnZ3JlZW4nO1xyXG4gICAgICBjdHguZm9udCA9ICdib2xkIDQ4cHggc2FuLXNlcmlmJztcclxuICAgICAgY3R4LmZpbGxUZXh0KFN0cmluZyhzY29yZSksIDUwLCAzMDApO1xyXG4gICAgICBjdHguZmlsbFRleHQoJ0dhbWUgT3ZlcicsIDUwLCA0MDApO1xyXG4gICAgICBjdHguZm9udCA9ICdib2xkIDMwcHggc2FuLXNlcmlmJztcclxuICAgICAgY3R4LmZpbGxUZXh0KFwiUHJlc3MgJ0VudGVyJyB0byBzdGFydCFcIiwgNTAsIDUwMCk7XHJcbiAgICB9XHJcblxyXG4gICAgYmxvY2suZHJhdygpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBib251cyAtLS0tLS0tLS0tLS1cclxuICBpZiAodGltZXIgJSAxMDAwID09PSAwKSB7XHJcbiAgICBjb25zdCBib251cyA9IG5ldyBCb251cygpO1xyXG4gICAgYm9udXNBcnJheS5wdXNoKGJvbnVzKTtcclxuICB9XHJcbiAgYm9udXNBcnJheS5mb3JFYWNoKChib251cywgaW5kZXgsIGFycmF5KSA9PiB7XHJcbiAgICBjb25zdCBjb2xsaWRlID1cclxuICAgICAgQ29sbGlzaW9uKHBsYXllciwgYm9udXMpIHx8XHJcbiAgICAgIExlZnRDb2xsaXNpb24ocGxheWVyLCBib251cykgfHxcclxuICAgICAgUmlnaHRDb2xsaXNpb24ocGxheWVyLCBib251cyk7XHJcblxyXG4gICAgY29sbGlkZSAmJiAoc2NvcmUgKz0gMTApO1xyXG5cclxuICAgIGJvbnVzLnkgPCA5MDAgJiYgIWNvbGxpZGUgPyAoYm9udXMueSArPSA1KSA6IGFycmF5LnNwbGljZShpbmRleCwgMSk7XHJcblxyXG4gICAgYm9udXMuZHJhdygpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBjb250cm9sIC0tLS0tLS0tLS0tLVxyXG4gIEdvTGVmdChwbGF5ZXIpO1xyXG4gIEdvUmlnaHQocGxheWVyKTtcclxuICBnb0xlZnQgJiYgbGVmdFRpbWVyKys7XHJcbiAgZ29SaWdodCAmJiByaWdodFRpbWVyKys7XHJcbiAgaWYgKGxlZnRUaW1lciA+IFRJTUVSX1RJTUUpIHtcclxuICAgIGdvTGVmdCA9IGZhbHNlO1xyXG4gICAgbGVmdFRpbWVyID0gMDtcclxuICB9XHJcbiAgaWYgKHJpZ2h0VGltZXIgPiBUSU1FUl9USU1FKSB7XHJcbiAgICBnb1JpZ2h0ID0gZmFsc2U7XHJcbiAgICByaWdodFRpbWVyID0gMDtcclxuICB9XHJcblxyXG4gIHBsYXllci5kcmF3KCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIENvbGxpc2lvbihwcmU6IEJsb2NrLCBjdXI6IEJsb2NrKSB7XHJcbiAgY29uc3QgeENvbGxpc2lvbiA9IE1hdGguYWJzKHByZS54IC0gY3VyLngpIDwgcHJlLndpZHRoO1xyXG4gIGNvbnN0IHlDb2xsaXNpb24gPSBwcmUueSAtIGN1ci55ID09PSBwcmUuaGVpZ2h0O1xyXG4gIHJldHVybiB4Q29sbGlzaW9uICYmIHlDb2xsaXNpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIExlZnRDb2xsaXNpb24ocHJlOiBCbG9jaywgY3VyOiBCbG9jaykge1xyXG4gIGNvbnN0IHhDb2xsaXNpb24gPSBwcmUueCAtIGN1ci54IDw9IHByZS53aWR0aCAmJiBwcmUueCAtIGN1ci54ID4gMDtcclxuICBjb25zdCB5Q29sbGlzaW9uID0gTWF0aC5hYnMocHJlLnkgLSBjdXIueSkgPCBwcmUuaGVpZ2h0O1xyXG4gIHJldHVybiB4Q29sbGlzaW9uICYmIHlDb2xsaXNpb247XHJcbn1cclxuXHJcbmZ1bmN0aW9uIFJpZ2h0Q29sbGlzaW9uKHByZTogQmxvY2ssIGN1cjogQmxvY2spIHtcclxuICBjb25zdCB4Q29sbGlzaW9uID0gY3VyLnggLSBwcmUueCA8PSBwcmUud2lkdGggJiYgY3VyLnggLSBwcmUueCA+IDA7XHJcbiAgY29uc3QgeUNvbGxpc2lvbiA9IE1hdGguYWJzKHByZS55IC0gY3VyLnkpIDwgcHJlLmhlaWdodDtcclxuICByZXR1cm4geENvbGxpc2lvbiAmJiB5Q29sbGlzaW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiBHb0xlZnQodGhpbmc6IEJsb2NrKSB7XHJcbiAgcGxheWVyLnggPiAwICYmIGdvTGVmdCAmJiAodGhpbmcueCAtPSBNT1ZFX1NQRUVEKTtcclxufVxyXG5mdW5jdGlvbiBHb1JpZ2h0KHRoaW5nOiBCbG9jaykge1xyXG4gIHBsYXllci54ICsgcGxheWVyLndpZHRoIDwgY2FudmFzLndpZHRoICYmIGdvUmlnaHQgJiYgKHRoaW5nLnggKz0gTU9WRV9TUEVFRCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUxlZnRFdmVudCgpIHtcclxuICBpZiAoY3VyU3RhdHVzID09PSAnaW50cm8nICYmIERJRkZJQ1VMVFkgPiAxKSB7XHJcbiAgICBESUZGSUNVTFRZLS07XHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDEwMCwgNTAwLCAyNTApO1xyXG4gICAgY3R4LmZpbGxUZXh0KGBEaWZmaWN1bHR5OiAke1N0cmluZyhESUZGSUNVTFRZKX1gLCA1MCwgMzAwKTtcclxuICB9XHJcbn1cclxuZnVuY3Rpb24gaGFuZGxlUmlnaHRFdmVudCgpIHtcclxuICBpZiAoY3VyU3RhdHVzID09PSAnaW50cm8nICYmIERJRkZJQ1VMVFkgPCA2KSB7XHJcbiAgICBESUZGSUNVTFRZKys7XHJcbiAgICBjdHguY2xlYXJSZWN0KDAsIDEwMCwgNTAwLCAyNTApO1xyXG4gICAgY3R4LmZpbGxUZXh0KGBEaWZmaWN1bHR5OiAke1N0cmluZyhESUZGSUNVTFRZKX1gLCA1MCwgMzAwKTtcclxuICB9XHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoa2V5KSA9PiB7XHJcbiAgc3dpdGNoIChrZXkuY29kZSkge1xyXG4gICAgY2FzZSAnRW50ZXInOlxyXG4gICAgICBpZiAoY3VyU3RhdHVzID09PSAnaW50cm8nKSB7XHJcbiAgICAgICAgYW5pbWF0aW9uID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEZyYW1lKTtcclxuICAgICAgICBjdXJTdGF0dXMgPSAnc3RhcnQnO1xyXG4gICAgICB9IGVsc2UgaWYgKGN1clN0YXR1cyA9PT0gJ2VuZCcpIHtcclxuICAgICAgICBibG9ja0FycmF5LnNwbGljZSgwKTtcclxuICAgICAgICBib251c0FycmF5LnNwbGljZSgwKTtcclxuICAgICAgICB0aW1lciA9IDA7XHJcbiAgICAgICAgc2NvcmUgPSAwO1xyXG4gICAgICAgIGNhblVzZUl0ZW0gPSB0cnVlO1xyXG4gICAgICAgIGFuaW1hdGlvbiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShGcmFtZSk7XHJcbiAgICAgICAgY3VyU3RhdHVzID0gJ3N0YXJ0JztcclxuICAgICAgfVxyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ0Fycm93TGVmdCc6XHJcbiAgICBjYXNlICdLZXlBJzpcclxuICAgICAgaGFuZGxlTGVmdEV2ZW50KCk7XHJcbiAgICAgIGdvTGVmdCA9IHRydWU7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAnQXJyb3dSaWdodCc6XHJcbiAgICBjYXNlICdLZXlEJzpcclxuICAgICAgaGFuZGxlUmlnaHRFdmVudCgpO1xyXG4gICAgICBnb1JpZ2h0ID0gdHJ1ZTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdTcGFjZSc6XHJcbiAgICAgIGlmIChjYW5Vc2VJdGVtID09PSB0cnVlKSB7XHJcbiAgICAgICAgYmxvY2tBcnJheS5zcGxpY2UoMCk7XHJcbiAgICAgICAgY2FuVXNlSXRlbSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAnRXNjYXBlJzpcclxuICAgICAgaWYgKGN1clN0YXR1cyA9PT0gJ2VuZCcpIHtcclxuICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgY3R4LmZpbGxUZXh0KFwiUHJlc3MgJ0VudGVyJyB0byBzdGFydCFcIiwgNTAsIDQwMCk7XHJcbiAgICAgICAgY3VyU3RhdHVzID0gJ2ludHJvJztcclxuICAgICAgfVxyXG4gIH1cclxufSk7XHJcblxyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChldmVudCkgPT4ge1xyXG4gIGNvbnN0IHhUb3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFg7XHJcbiAgY29uc3QgeVRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WTtcclxuICBpZiAoY3VyU3RhdHVzID09PSAnaW50cm8nKSB7XHJcbiAgICBsb25nVGFiVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgYW5pbWF0aW9uID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEZyYW1lKTtcclxuICAgICAgY3VyU3RhdHVzID0gJ3N0YXJ0JztcclxuICAgIH0sIDEwMDApO1xyXG4gIH0gZWxzZSBpZiAoY3VyU3RhdHVzID09PSAnZW5kJykge1xyXG4gICAgbG9uZ1RhYlRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGJsb2NrQXJyYXkuc3BsaWNlKDApO1xyXG4gICAgICBib251c0FycmF5LnNwbGljZSgwKTtcclxuICAgICAgdGltZXIgPSAwO1xyXG4gICAgICBzY29yZSA9IDA7XHJcbiAgICAgIGNhblVzZUl0ZW0gPSB0cnVlO1xyXG4gICAgICBhbmltYXRpb24gPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoRnJhbWUpO1xyXG4gICAgICBjdXJTdGF0dXMgPSAnc3RhcnQnO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgfVxyXG4gIGlmICh5VG91Y2ggPCAzMDAgJiYgY2FuVXNlSXRlbSkge1xyXG4gICAgYmxvY2tBcnJheS5zcGxpY2UoMCk7XHJcbiAgICBjYW5Vc2VJdGVtID0gZmFsc2U7XHJcbiAgfVxyXG4gIGlmICh4VG91Y2ggPCBjYW52YXMud2lkdGggLyAyKSB7XHJcbiAgICBnb0xlZnQgPSB0cnVlO1xyXG4gIH0gZWxzZSBpZiAoeFRvdWNoID4gY2FudmFzLndpZHRoIC8gMikge1xyXG4gICAgZ29SaWdodCA9IHRydWU7XHJcbiAgfVxyXG59KTtcclxuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgKGV2ZW50KSA9PiB7XHJcbiAgY29uc3QgeFRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WDtcclxuICBjb25zdCB5VG91Y2ggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZO1xyXG4gIGNsZWFyVGltZW91dChsb25nVGFiVGltZXIpO1xyXG4gIGlmICh4VG91Y2ggPCBjYW52YXMud2lkdGggLyAyKSB7XHJcbiAgICBoYW5kbGVMZWZ0RXZlbnQoKTtcclxuICB9IGVsc2UgaWYgKHhUb3VjaCA+IGNhbnZhcy53aWR0aCAvIDIpIHtcclxuICAgIGhhbmRsZVJpZ2h0RXZlbnQoKTtcclxuICB9XHJcbn0pO1xyXG5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgKCkgPT4ge1xyXG4gIGNsZWFyVGltZW91dChsb25nVGFiVGltZXIpO1xyXG59KTtcclxuIl0sIm5hbWVzIjpbImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjdHgiLCJnZXRDb250ZXh0Iiwid2lkdGgiLCJoZWlnaHQiLCJzdHlsZSIsImJvcmRlciIsInBvc2l0aW9uIiwibGVmdCIsInRvcCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsInBsYXllciIsIngiLCJ5IiwiZHJhdyIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwibG9jYXRpb24iLCJNYXRoIiwicmFuZG9tIiwiRElGRklDVUxUWSIsIkJsb2NrIiwiQm9udXMiLCJ0aW1lciIsInNjb3JlIiwiZ29MZWZ0IiwiZ29SaWdodCIsImxlZnRUaW1lciIsInJpZ2h0VGltZXIiLCJjYW5Vc2VJdGVtIiwiY3VyU3RhdHVzIiwiYW5pbWF0aW9uIiwibG9uZ1RhYlRpbWVyIiwiQkxPQ0tfVElNRSIsIk1PVkVfU1BFRUQiLCJUSU1FUl9USU1FIiwiYmxvY2tBcnJheSIsImJvbnVzQXJyYXkiLCJmb250IiwiZmlsbFRleHQiLCJTdHJpbmciLCJGcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNsZWFyUmVjdCIsImkiLCJibG9jayIsInB1c2giLCJmb3JFYWNoIiwiaW5kZXgiLCJhcnJheSIsIkNvbGxpc2lvbkNoZWNrIiwiZm4iLCJmaWx0ZXIiLCJ2IiwiZmluZEluZGV4Iiwic3RvcGVkQmxvY2siLCJjb2xsaXNpb25FYWNoT3RoZXIiLCJDb2xsaXNpb24iLCJMZWZ0Q29sbGlzaW9uRWFjaE90aGVyIiwiTGVmdENvbGxpc2lvbiIsIlJpZ2h0Q29sbGlzaW9uRWFjaE90aGVyIiwiUmlnaHRDb2xsaXNpb24iLCJzdGFja2luZyIsInB1c2hpbmdMZWZ0IiwicHVzaGluZ1JpZ2h0Iiwic3BsaWNlIiwiR29MZWZ0IiwiR29SaWdodCIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwiYm9udXMiLCJjb2xsaWRlIiwicHJlIiwiY3VyIiwieENvbGxpc2lvbiIsImFicyIsInlDb2xsaXNpb24iLCJ0aGluZyIsImhhbmRsZUxlZnRFdmVudCIsImhhbmRsZVJpZ2h0RXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwia2V5IiwiY29kZSIsImV2ZW50IiwieFRvdWNoIiwiY2hhbmdlZFRvdWNoZXMiLCJjbGllbnRYIiwieVRvdWNoIiwiY2xpZW50WSIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiXSwic291cmNlUm9vdCI6IiJ9